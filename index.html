<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Option Move Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }

    h1, h2 { color: #93c5fd; }

    .box {
      background: #020617;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
    }

    label {
      display: block;
      margin-bottom: 8px;
    }

    input, select, button {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      margin-top: 10px;
      cursor: pointer;
    }

    #output {
      font-size: 1.1em;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h1>My Quant's Option Calculator</h1>

  <div class="box">
    <label>Underlying Price
      <input id="underlying" type="number" step="0.01" />
    </label>

    <label>Option Price (mid)
      <input id="optionPrice" type="number" step="0.01" />
    </label>

    <label>Delta
      <input id="delta" type="number" step="0.0001" />
    </label>

    <label>Gamma
      <input id="gamma" type="number" step="0.0001" />
    </label>

    <label>Theta (per day)
      <input id="theta" type="number" step="0.0001" />
    </label>
  </div>

  <div class="box">
    <h2>Target</h2>

    <label>Target Option Price
      <input id="targetPrice" type="number" step="0.01" />
    </label>

    <label>Time Horizon
      <select id="timeHorizon">
        <option value="0">Now</option>
        <option value="1">1 day</option>
        <option value="2">2 days</option>
        <option value="3">3 days</option>
        <option value="4">4 days</option>
        <option value="5">5 days</option>
      </select>
    </label>

    <button id="calculate">Calculate Required Move</button>
  </div>

  <div class="box" id="output"></div>

  <script>
    function requiredStockMove({ optionPrice, targetPrice, delta, gamma, theta, timeDays }) {
      const dC = targetPrice - optionPrice;

      const a = 0.5 * gamma;
      const b = delta;
      const c = theta * timeDays - dC;

      // Linear fallback if gamma is ~0
      if (Math.abs(a) < 1e-12) {
        if (Math.abs(b) < 1e-12) return null;
        return -c / b;
      }

      const discriminant = b * b - 4 * a * c;
      if (discriminant < 0) return null;

      const sqrtD = Math.sqrt(discriminant);
      const root1 = (-b + sqrtD) / (2 * a);
      const root2 = (-b - sqrtD) / (2 * a);

      return Math.abs(root1) < Math.abs(root2) ? root1 : root2;
    }

    const calcBtn = document.getElementById('calculate');
    const output = document.getElementById('output');

    calcBtn.onclick = () => {
      const underlying  = parseFloat(document.getElementById('underlying').value);
      const optionPrice = parseFloat(document.getElementById('optionPrice').value);
      const targetPrice = parseFloat(document.getElementById('targetPrice').value);
      const delta       = parseFloat(document.getElementById('delta').value);
      const gamma       = parseFloat(document.getElementById('gamma').value);
      const theta       = parseFloat(document.getElementById('theta').value);
      const timeDays    = parseFloat(document.getElementById('timeHorizon').value);

      if (
        isNaN(underlying) ||
        isNaN(optionPrice) ||
        isNaN(targetPrice) ||
        isNaN(delta) ||
        isNaN(gamma) ||
        isNaN(theta) ||
        isNaN(timeDays)
      ) {
        output.textContent = "Please fill in all fields.";
        return;
      }

      const move = requiredStockMove({
        optionPrice,
        targetPrice,
        delta,
        gamma,
        theta,
        timeDays
      });

if (move === null) {
  const dC = targetPrice - optionPrice;
  const a = 0.5 * gamma;
  const b = delta;

  // Under frozen greeks, change is: dC(x) = b*x + a*x^2 + theta*timeDays
  // If a>0 (normal), the MOST negative change happens at x* = -b/(2a)
  let minChange = null;
  let minAtMove = null;
  let minReachablePrice = null;

  if (Math.abs(a) > 1e-12) {
    minAtMove = -b / (2 * a);
    minChange = (b * minAtMove) + (a * minAtMove * minAtMove) + (theta * timeDays);
    minReachablePrice = optionPrice + minChange;
  }

  // How far beyond the frozen-greeks minimum are you asking?
  const extraBeyondMin =
    (minChange === null) ? null : (dC - minChange); // negative = asking for more drop than possible

  // Rough constraints for "greeks must change":
  // discriminant = b^2 - 4*a*(theta*timeDays - dC) must be >= 0
  // With a=0.5*gamma -> discriminant = b^2 - 2*gamma*(theta*timeDays - dC)
  const need = (theta * timeDays - dC); // if >0, you're demanding too much drop for given delta/gamma
  let gammaMax = null;
  if (need > 0) gammaMax = (b * b) / (2 * need);

  let deltaMinAbs = null;
  if (need > 0 && gamma > 0) deltaMinAbs = Math.sqrt(2 * gamma * need);

  let msg =
    "No real solution under *frozen* Greeks (delta/gamma/theta held constant).\n\n" +
    `Inputs imply dC = target - current = ${dC.toFixed(4)}\n` +
    `TimeDays=${timeDays}\n\n`;

  if (minReachablePrice !== null && isFinite(minReachablePrice)) {
    msg +=
      "Frozen-Greeks limit (with your delta & gamma):\n" +
      `• Lowest reachable option price ≈ ${minReachablePrice.toFixed(4)}\n` +
      `• This occurs around underlying move ≈ ${minAtMove.toFixed(2)}\n\n`;

    if (extraBeyondMin !== null && extraBeyondMin < 0) {
      msg +=
        "Your target is beyond that limit by:\n" +
        `• ${Math.abs(extraBeyondMin).toFixed(4)} option-price points\n\n`;
    }
  }

  msg +=
    "So yes, the market can still do it — but ONLY if Greeks/IV change as price moves.\n\n" +
    "Rough 'Greeks must change' constraints (holding the others fixed):\n";

  if (gammaMax !== null && isFinite(gammaMax)) {
    msg += `• To have ANY real solution with this delta, gamma would need to be ≤ ${gammaMax.toFixed(6)}\n`;
  } else {
    msg += "• (Not in a 'too-much-drop' regime for the gamma constraint)\n";
  }

  if (deltaMinAbs !== null && isFinite(deltaMinAbs)) {
    msg += `• Or with this gamma, |delta| would need to be ≥ ${deltaMinAbs.toFixed(6)}\n`;
  }

  msg +=
    "\nTip: pick 1 day+ (theta applies), or understand 0DTE intraday Greeks shift fast.";

  output.textContent = msg;
  return;
}

      const targetStock = underlying + move;

      output.textContent =
        `Required underlying move: ${move.toFixed(2)}\n` +
        `Target underlying price: ${targetStock.toFixed(2)}\n\n` +
        `Assumptions:\n` +
        `• IV flat\n` +
        `• Greeks locally valid\n` +
        `• Small–moderate move only`;
    };
  </script>
</body>
</html>
