<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Option Move Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }

    h1, h2 { color: #93c5fd; }

    .box {
      background: #020617;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
    }

    label {
      display: block;
      margin-bottom: 8px;
    }

    input, select, button {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      margin-top: 10px;
      cursor: pointer;
    }

    #output {
      font-size: 1.1em;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h1>My Quant's Option Calculator</h1>

  <div class="box">
    <label>Underlying Price
      <input id="underlying" type="number" step="0.01" />
    </label>

    <label>Option Price (mid)
      <input id="optionPrice" type="number" step="0.01" />
    </label>

    <label>Delta
      <input id="delta" type="number" step="0.0001" />
    </label>

    <label>Gamma
      <input id="gamma" type="number" step="0.0001" />
    </label>

    <label>Theta (per day)
      <input id="theta" type="number" step="0.0001" />
    </label>
  </div>

  <div class="box">
    <h2>Target</h2>

    <label>Target Option Price
      <input id="targetPrice" type="number" step="0.01" />
    </label>

    <label>Time Horizon
      <select id="timeHorizon">
        <option value="0">Now</option>
        <option value="1">1 day</option>
        <option value="2">2 days</option>
        <option value="3">3 days</option>
        <option value="4">4 days</option>
        <option value="5">5 days</option>
      </select>
    </label>

    <button id="calculate">Calculate Required Move</button>
  </div>

  <div class="box" id="output"></div>

  <script>
    function requiredStockMove({ optionPrice, targetPrice, delta, gamma, theta, timeDays }) {
      const dC = targetPrice - optionPrice;

      const a = 0.5 * gamma;
      const b = delta;
      const c = theta * timeDays - dC;

      // Linear fallback if gamma is ~0
      if (Math.abs(a) < 1e-12) {
        if (Math.abs(b) < 1e-12) return null;
        return -c / b;
      }

      const discriminant = b * b - 4 * a * c;
      if (discriminant < 0) return null;

      const sqrtD = Math.sqrt(discriminant);
      const root1 = (-b + sqrtD) / (2 * a);
      const root2 = (-b - sqrtD) / (2 * a);

      return Math.abs(root1) < Math.abs(root2) ? root1 : root2;
    }

    const calcBtn = document.getElementById('calculate');
    const output = document.getElementById('output');

    calcBtn.onclick = () => {
      const underlying  = parseFloat(document.getElementById('underlying').value);
      const optionPrice = parseFloat(document.getElementById('optionPrice').value);
      const targetPrice = parseFloat(document.getElementById('targetPrice').value);
      const delta       = parseFloat(document.getElementById('delta').value);
      const gamma       = parseFloat(document.getElementById('gamma').value);
      const theta       = parseFloat(document.getElementById('theta').value);
      const timeDays    = parseFloat(document.getElementById('timeHorizon').value);

      if (
        isNaN(underlying) ||
        isNaN(optionPrice) ||
        isNaN(targetPrice) ||
        isNaN(delta) ||
        isNaN(gamma) ||
        isNaN(theta) ||
        isNaN(timeDays)
      ) {
        output.textContent = "Please fill in all fields.";
        return;
      }

      const move = requiredStockMove({
        optionPrice,
        targetPrice,
        delta,
        gamma,
        theta,
        timeDays
      });

      if (move === null) {
        // Helpful debug + truthful message
        const dC = targetPrice - optionPrice;
        const a = 0.5 * gamma;
        const b = delta;
        const c = theta * timeDays - dC;
        const discriminant = b * b - 4 * a * c;

        output.textContent =
          "No real solution.\n" +
          `discriminant=${discriminant}\n` +
          `a=${a}, b=${b}, c=${c}\n` +
          `dC=${dC}, timeDays=${timeDays}\n\n` +
          "Try:\n" +
          "• increasing time horizon (theta decay)\n" +
          "• using updated delta/gamma\n" +
          "• smaller target change\n" +
          "• or note IV changes aren't modeled.";
        return;
      }

      const targetStock = underlying + move;

      output.textContent =
        `Required underlying move: ${move.toFixed(2)}\n` +
        `Target underlying price: ${targetStock.toFixed(2)}\n\n` +
        `Assumptions:\n` +
        `• IV flat\n` +
        `• Greeks locally valid\n` +
        `• Small–moderate move only`;
    };
  </script>
</body>
</html>
